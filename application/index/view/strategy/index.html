{extend name="layouts/layout_user" /}

{block name="title"}
策略
{/block}

{block name="style"}
<style type="text/css">
    body{
        background: #f5f5f5!important;
    }
    .zixuan_list{
        margin-bottom: 70px;
    }
</style>
{/block}

{block name="body"}
<body>
{/block}

{block name="content"}
    <header class="strategy_top">
        <p>
            <a href="javascript:void(0);" class="active">策略</a>
            <a href="position.html">持仓</a>
        </p>
    </header>
    <div class="search_con">
        <input id="searchInput" placeholder="请输入股票代码/名称"/>
    </div>
    <div class="search_content_box">
        <div class="search_history">
            <h1 class="search_h_title clear_fl">
                搜索历史
                <a href="" class="rt">清空</a>
            </h1>
            <ul class="search_h_list">
                <li>
                    <a  class="flex_nowrap" href="hangqing.html?code=600179">
                        <span>招商银行 600179</span>
                        <span class="red">28.17</span>
                        <span class="red">+8.17%</span>
                        <span class="add_h_btn"><img src="__RESOURCE__/img/add_btn.png"></span>
                        <span class="remove_btn"><img class="rt" src="__RESOURCE__/img/remove_btn.png"></span>
                    </a>
                </li>
                <li>
                    <a  class="flex_nowrap" href="hangqing.html?code=300664">
                        <span>鹏鹞环保 300664</span>
                        <span class="red">28.17</span>
                        <span class="red">+8.17%</span>
                        <span class="add_h_btn"><img src="__RESOURCE__/img/add_btn.png"></span>
                        <span class="remove_btn"><img class="rt" src="__RESOURCE__/img/remove_btn.png"></span>
                    </a>
                </li>
                <li>
                    <a  class="flex_nowrap" href="hangqing.html?code=603980">
                        <span>吉华集团 603980</span>
                        <span class="red">28.17</span>
                        <span class="red">+8.17%</span>
                        <span class="add_h_btn"><img src="__RESOURCE__/img/add_btn.png"></span>
                        <span class="remove_btn"><img class="rt" src="__RESOURCE__/img/remove_btn.png"></span>
                    </a>
                </li>
                <li>
                    <a  class="flex_nowrap" href="hangqing.html?code=601566">
                        <span>九牧王 601566</span>
                        <span class="red">28.17</span>
                        <span class="red">+8.17%</span>
                        <span class="add_h_btn"><img src="__RESOURCE__/img/add_btn.png"></span>
                        <span class="remove_btn"><img class="rt" src="__RESOURCE__/img/remove_btn.png"></span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="search_history hot_recommend" style="margin-top: 8px;">
            <h1 class="search_h_title clear_fl">热门推荐</h1>
            <ul class="recommend_list flex_nowrap">
                {volist name="hots" id="item"}
                <li>
                    <a href="{:url('index/Stock/stockBuy', ['code' => $item.code])}">
                        <p class="shares_name">{$item.name}</p>
                        <p class="shares_code">{$item.code}</p>
                        <p class="shares_price">{$item.last_px}</p>
                        <p class="shares_detail">
                            <span>{$item.px_change}</span>
                            <span>{$item.px_change_rate}%</span>
                        </p>
                    </a>
                </li>
                {/volist}
            </ul>
        </div>
    </div>
{/block}

{block name="nav"}
    <nav class="ml_tab mui-bar mui-bar-tab">
        <a class="mui-tab-item" href="{:url('index/Index/index')}">
            <span class="mui-icon mui-icon-home"></span>
            <span class="mui-tab-label">首页</span>
        </a>
        <a class="mui-tab-item" href="{:url('index/User/optional')}">
            <span class="mui-icon mui-icon-zixuan"></span>
            <span class="mui-tab-label">自选</span>
        </a>
        <a class="mui-tab-item center_item" href="{:url('index/Ai/index')}">
            <span class="mui-icon mui-icon-celue"></span>
            <span class="mui-tab-label">AI智能推荐</span>
        </a>
        <a class="mui-tab-item mui-active" href="javascript:void(0);">
            <span class="mui-icon mui-icon-jingu"></span>
            <span class="mui-tab-label">策略</span>
        </a>
        <a class="mui-tab-item" href="{:url('index/User/index')}">
            <span class="mui-icon mui-icon-my"></span>
            <span class="mui-tab-label">我的</span>
        </a>
    </nav>
{/block}

{block name="script"}
    <script type="text/javascript" src="__STATIC__/js/stock.js"></script>
    <script src="__RESOURCE__/js/jquery-2.2.0.min.js"></script>
    <script type="text/javascript" src="__RESOURCE__/js/common.js"></script>
    <script type="text/javascript">
        mui.init({
            swipeBack: true //启用右滑关闭功能
        })
        //选项卡
         mui('body').on('tap', 'a', function() {
            var data_href = this.getAttribute("data-href");
            var href = this.getAttribute("href");
            var url=data_href;
            if(!url||url==''){
                url=href;
            }
            window.location.href = url;
         });



         $("#searchInput").keyup(function(){
            var val = $(this).val();
            displayItems(val);
        });

        var searchCon = $(".search_content_box").html();
        function displayItems(items) {
            var code = new Array();
            var html = "";
            if (items==''){ //搜索结果为空， 置空列表
                html=searchCon;
                $(".search_content_box").html( html );
            }else{
                var j = 0;
                for (var i = 0; i < stocks.length; i++) {
                    var reg = new RegExp('^' + items + '.*$', 'im');
                    if (reg.test(stocks[i][0]) || reg.test(stocks[i][1]) || reg.test(stocks[i][2]) || reg.test(stocks[i][3])) {
                        if(j < 15){
                            code.push( stocks[i][1] );
                            j++;
                        }else{
                            break;
                        }
                    }
                }

                if(code.length == 0){
                    var html = '<ul><li class="no_more"></li><li style="text-align:center;font-size:12px;color:#999;background:transparent;border:none;">暂无搜索结果</li></ul>';
                    $(".search_content_box").html( html );
                }

                code = code.join(",");
                var _url = "{:url('index/Stock/simple')}",
                    _oData = {code: code};
                $ajaxCustom(_url, _oData, function(res){
                    if(res.state){ // 登录成功
                        for( var key in res.data ){
                            var rate = parseFloat(res.data[key].px_change_rate);
                            var className = "";
                            if(rate >= 0){
                                className = "red"
                            }else{
                                className = "green"
                            }
                            html += '<li class="list_header flex_nowrap">\
                                        <div style="width: 15%; display: none;" class="mui-input-row mui-checkbox mui-left select_btn">\
                                            <label></label>\
                                            <input name="checkbox" value="Item 1" type="checkbox">\
                                        </div>\
                                        <div style="width:80%" class="flex_nowrap" href="/stock/home.html?code='+ res.data[key].code +'">\
                                            <span class="zi_name" style="width:80%;padding-left: 18px;"> <span>'+ res.data[key].prod_name +'</span><span>' + res.data[key].code + '</span></span>\
                                            <span style="width:40%" class="' + className + '">' + res.data[key].last_px + '</span>\
                                            <span style="width:40%" class="' + className + '">' + res.data[key].px_change_rate + '%</span>\
                                            \
                                        </div>\
                                        <span style="width:20%">\
                                            <span href="" class="mui-btn mui-btn-success mui-btn-outlined">创建策略</span>\
                                        </span>\
                                    </li>';
                        }

                        $(".search_content_box").html( "<ul class='zixuan_list'></ul>" );
                        $(".zixuan_list").html(html);
                    }else{
                        // $alert(res.info);
                    }
                });
            }
        }


        //搜索历史
        $(".search_content_box").on("click", ".zixuan_list li", function(){
            var code = $(this).find(".zi_name span+span").html();
            var storage = window.localStorage;
            if( storage.searchHistory ){
                var searchHistory = storage.searchHistory;
                searchHistory = searchHistory + "," + code;
            }
        });


    </script>
{/block}